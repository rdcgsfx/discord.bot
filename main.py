import os
import discord
from discord.ext import commands
from discord import app_commands

from Myserver import sever_on

# р╕Бр╕│р╕лр╕Щр╕Ф Intents р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Гр╕лр╣Й Bot р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Чр╕│р╕Зр╕▓р╕Щр╕Бр╕▒р╕Ър╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Др╕Фр╣Й
intents = discord.Intents.default()
intents.members = True  # р╣Ар╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ event р╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣И

# р╕Бр╕│р╕лр╕Щр╕Ф prefix р╕Вр╕нр╕Зр╕Др╕│р╕кр╕▒р╣Ир╕З Bot
bot = commands.Bot(command_prefix="!", intents=intents)

# event р╣Ар╕бр╕╖р╣Ир╕н Bot р╕Юр╕гр╣Йр╕нр╕бр╕Чр╕│р╕Зр╕▓р╕Щ
@bot.event
async def on_ready():
    print(f'Logged in as {bot.user}')

# event р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ър╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣И
@bot.event
async def on_member_join(member):
    # р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ър╣Ар╕бр╕╖р╣Ир╕нр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣Ир╣Ар╕Вр╣Йр╕▓р╕бр╕▓
    channel = discord.utils.get(member.guild.text_channels, name="general")  # р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щр╕Кр╕╖р╣Ир╕нр╕Кр╣Ир╕нр╕Зр╕Чр╕╡р╣Ир╕Др╕╕р╕Ур╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г
    if channel:
        # р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ъ
        message = await channel.send(f"ЁЯМЯтЬир╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ър╕Чр╕╕р╕Бр╕Чр╣Ир╕▓р╕Щ┬░.тЗв ╦Ч╦П╦Л{member.mention}р┐Рр╛В р╕кр╕╣р╣Ир╣Вр╕ер╕Бр╣Бр╕лр╣Ир╕Зр╕Бр╕▓р╕гр╣Др╕Вр╕Ыр╕гр╕┤р╕ир╕Щр╕▓р╣Гр╕Щр╕Др╕др╕лр╕▓р╕кр╕Щр╣Мр╕лр╕ер╕▒р╕Зр╣Гр╕лр╕Нр╣И ЁЯФН\n"
                                     f"р╣Ар╕Ир╣Йр╕▓р╕Бр╣Йр╕▓р╕зр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╣Вр╕ер╕Бр╕Чр╕╡р╣Ир╕Др╕зр╕▓р╕бр╕ер╕▒р╕Ър╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╕Ир╕гр╕┤р╕Зр╕Лр╣Ир╕нр╕Щр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕Чр╕╕р╕Бр╕бр╕╕р╕бр╕бр╕╖р╕Фр╕Вр╕нр╕Зр╕Др╕др╕лр╕▓р╕кр╕Щр╣Мр╕Щр╕╡р╣Й ЁЯХ╡я╕ПтАНтЩВя╕П\n"
                                     f"р╕Чр╣Ир╕▓р╕Щр╕Ир╕░р╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Йр╣Др╕лр╕зр╕Юр╕гр╕┤р╕Ър╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╕Бр╕ер╣Йр╕▓р╕лр╕▓р╕Нр╣Гр╕Щр╕Бр╕▓р╕гр╕Др╣Йр╕Щр╕лр╕▓р╕Др╕│р╕Хр╕нр╕Ъ... р╕Чр╕╕р╕Бр╕Бр╣Йр╕▓р╕зр╕Чр╕╡р╣Ир╣Ар╕Фр╕┤р╕Щр╕Ир╕░р╕Юр╕▓р╣Ар╕Ир╣Йр╕▓р╕лр╕бр╕╕р╕Щр╕зр╕Щр╣Гр╕Бр╕ер╣Йр╕Др╕зр╕▓р╕бр╕Ир╕гр╕┤р╕Зр╕Чр╕╡р╣Ир╕вр╕▒р╕Зр╕Др╕Зр╕ер╕╢р╕Бр╕ер╕▒р╕Ъ ЁЯМСтЬи\n"
                                     f"р╕лр╕зр╕▒р╕Зр╕зр╣Ир╕▓р╕Чр╕╕р╣Ир╕▓р╕Щр╕Ир╕░р╣Ар╕Юр╕ер╕┤р╕Фр╣Ар╕Юр╕ер╕┤р╕Щр╣Др╕Ыр╕Бр╕▒р╕Ър╕Бр╕▓р╕гр╣Др╕Вр╕Ыр╕гр╕┤р╕ир╕Щр╕▓"
                                     f"--------------------------------\n"
                                     f"р╕нр╣Ир╕▓р╕Щр╕Бр╕Ор╣Др╕Фр╣Йр╕Чр╕╡р╣ИЁЯУв : #═А╠ЧтЮЫр╕нр╣Ир╕▓р╕Щр╕Бр╕Ор╣Др╕Фр╣Йр╕Чр╕╡р╣Ия╜бя╜ея╛Яя╛Яя╜е\n"
                                     f"р╕нр╣Ир╕▓р╕Щр╕Ър╕Чр╕Ър╕▓р╕Чр╣Др╕Фр╣Йр╕Чр╕╡р╣ИЁЯНА : #уАОр╕Ър╕Чр╕Ър╕▓р╕ЧуАП\n"
                                     f"р╕Бр╕Фр╕гр╕▒р╕Ър╕вр╕ир╣Др╕Фр╣Йр╕Чр╕╡р╣ИЁЯЧЭя╕П : #тФКр╕гр╕▒р╕Ър╕вр╕итФКтЮ╢я╜б╦Ъ┬░\n"
                                     f"р╕вр╕Бр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Бр╕Ър╕Ър╕Яр╕нр╕гр╣Мр╕бЁЯУг : #╦ЪтВК┬╖-═Я═Я═ЮтЮ│тЭер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Бр╕Ър╕Ър╕Яр╕нр╕гр╣Мр╕б\n")

        # р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕лр╣Йр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣Ир╣Ар╕ер╕╖р╕нр╕Бр╕нр╕┤р╣Вр╕бр╕Ир╕┤р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕▒р╕Ър╕вр╕и
        await message.add_reaction("ЁЯМ╗")  # р╕Бр╕Ф ЁЯМ╗ р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕▒р╕Ър╕вр╕и

    # event р╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡р╕Бр╕▓р╕гр╕Бр╕Фр╕нр╕┤р╣Вр╕бр╕Ир╕┤
@bot.event
async def on_reaction_add(reaction, user):
    if reaction.emoji == "тАНЁЯМ╗":
        role = discord.utils.get(user.guild.roles, name="Newcomer")
        if role:
            member = user
            await member.add_roles(role)  # р╕бр╕нр╕Ър╕вр╕ир╣Гр╕лр╣Йр╕Бр╕▒р╕Ър╕Ьр╕╣р╣Йр╕Чр╕╡р╣Ир╕Бр╕Ф тАНЁЯМ╗

server_on()

# р╣Ар╕гр╕┤р╣Ир╕бр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕З Bot
bot.run(os.getenv('TOKEN'))
